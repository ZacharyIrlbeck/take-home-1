<!DOCTYPE html>
<html>
    <head>
        <title>Inspiring Apps Game</title>     
        
        <style>
            .logo-back-container{
                position: relative;
                background: url("/ia-logo/ia-logo-back.png");
                height: 600px;
                width: 600px;
                border: none;
                margin: none;
            }

            .dot-container{
                position: absolute;
                height: 9em;
                width: 9em;
                border: 1px solid red;
                border-radius: 50%;
                display: flex;
                align-items: center; 
                justify-content: center;
            }

            .blue-container{
                left: 245px;
                top: 21px;
            }
            .red-container{
                right: 28px;
                top: 40px;
            }
            .black-container-2{
                top: 254px;
                right: 65px;
            }
            .black-container{
                left: 17px;
                top: 161px;
            }
            .green-container{
                bottom: 150px;
                left: 114px;
            }
        </style>
    </head>
    <body>
        <div id="dots"></div>
        <button id="reset-button">Reset</button>

        <div class="logo-back-container">
            <div id="black-container" class="dot-container black-container"></div>
            <div id="black-container-2" class="dot-container black-container-2"></div>
            <div id="blue-container" class="dot-container blue-container"></div>
            <div id="green-container" class="dot-container green-container"></div>
            <div id="red-container" class="dot-container red-container"></div>
        </div>

        
        <script>
            let currentDotId

            const dotContainers = document.querySelectorAll(".dot-container")

            for(let i = 0; i < dotContainers.length; i++){
                dotContainers[i].addEventListener("dragover", function(e){ e.preventDefault() })
                dotContainers[i].addEventListener("drop", handleDrop)
            }

            function handleDrop(e){
                if(!e.target.classList.contains("dot-container"))
                    return

                if(e.target.firstChild)
                    return

                const dotToAppend = document.getElementById(currentDotId)
                const containerColor = e.target.id.split("-")[0]
                const dotColor = currentDotId.split("-")[0]                

                if(dotColor === containerColor){
                    e.target.appendChild(dotToAppend)
                    if(dotsCont.childElementCount === 0){
                        congrats()
                    }
                }
            }

            function handleDragStart(e){
                currentDotId = e.target.id
            }

            const imageUrls = {
                "blue": "ia-logo/ia-logo-dot-blue.png",
                "black": "ia-logo/ia-logo-dot-black.png",
                "green": "ia-logo/ia-logo-dot-green.png",
                "red": "ia-logo/ia-logo-dot-red.png"
            }
            
            const dotElementNames = ["blue", "red", "green", "black", "black1"]
            let dotElements

            function addDotsToPage(){

                dotElements = dotElementNames.map((dotName) => {
                    return {
                        elm: document.createElement("img"),
                        name: dotName,
                        placed: false
                    }
                })

                dotElements.forEach((dotElm) => {
                    if(dotElm.name === "black1"){
                        dotElm.elm.setAttribute("src", imageUrls["black"])
                    }else{
                        dotElm.elm.setAttribute("src", imageUrls[dotElm.name])
                    }
                })

                dotElements.forEach((dotElm) => {
                    if(dotElm.name === "black"){
                        dotElm.elm.setAttribute("id", "black-dot-1")
                    }else if(dotElm.name === "black1"){
                        dotElm.elm.setAttribute("id", "black-dot-2")
                    }else{
                        dotElm.elm.setAttribute("id", dotElm.name + "-dot")
                    }
                })

                dotElements.forEach((dotElm) => {
                    dotElm.elm.setAttribute("draggable", "true")
                    dotElm.elm.classList.add("dot")
                })
                
                // then go ahead (later extract this out to methods), and add to the new div where the buttons are stored and .. violÃ¡!
                dotElements.forEach((dotElm) => {
                    dotsCont.appendChild(dotElm.elm)
                })

                dotElements.forEach((dotElm) => {
                    dotElm.elm.addEventListener("dragstart", handleDragStart)
                })

            }

            document.addEventListener("DOMContentLoaded", function(){ 
                addDotsToPage()
            })

            // okay, next order of business ... go ahead and do the reset button. This is a function that wil

            function reset(){
                dotContainers.forEach((dotContainer) => {
                    if(dotContainer.firstChild)
                        dotContainer.removeChild(dotContainer.firstChild)
                })

                removeDotsFromPage()
                addDotsToPage()
            }

            function removeDotsFromPage(){
                while(dotsCont.firstChild){
                    dotsCont.removeChild(dotsCont.firstChild)
                }
            }

            const resetButton = document.getElementById("reset-button")
            const dotsCont = document.getElementById("dots")

            resetButton.addEventListener("click", function(e){
                e.preventDefault()

                reset()
            })

            function congrats(){
                setTimeout(function(){
                    window.alert("Well done!")
                }, 200)
            }
        </script>
    </body>
</html>